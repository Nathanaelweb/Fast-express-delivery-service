<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Care Chat - Fast Express Delivery</title>

<style>
/* Reset and base */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f8f9fa;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    animation: fadeIn .8s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}


/* Chat container */
.chat-container {
    width: 380px;
    background: #fff;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
}

/* Header */
.chat-header {
    text-align: center;
    margin-bottom: 15px;
}
.chat-header h1 {
    color: #ff0000;
    font-size: 22px;
    font-weight: 700;
}
.chat-header p {
    color: #555;
    font-size: 14px;
}

/* Tracking input */
.track-input {
    display: flex;
    margin-bottom: 10px;
}
.track-input label {
    font-weight: bold;
    color: #ff0000;
    width: 35%;
    align-self: center;
}
.track-input input {
    width: 65%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

/* Chat box */
#chat-box {
    height: 320px;
    overflow-y: auto;
    border: 1px solid #ff9999;
    padding: 10px;
    border-radius: 8px;
    background: #fff5f5;
    margin-bottom: 10px;
}

/* Messages */
.message {
    margin-bottom: 8px;
    padding: 10px;
    border-radius: 12px;
    max-width: 75%;
    word-wrap: break-word;
    font-size: 14px;
}
.sender-message {
    background: #ff4d4d;
    color: #fff;
    text-align: right;
    margin-left: auto;
}
.receiver-message {
    background: #ff0000;
    color: #fff;
    text-align: left;
    margin-right: auto;
}
.timestamp {
    display: block;
    font-size: 10px;
    color: #fff;
    margin-top: 3px;
}

/* Inputs & buttons */
.input-row {
    display: flex;
    gap: 5px;
    margin-bottom: 10px;
}
.input-row input {
    flex: 1;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
.input-row button {
    padding: 8px 12px;
    border-radius: 5px;
    border: none;
    background-color: #ff0000;
    color: #fff;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s;
}
.input-row button:hover {
    background-color: #cc0000;
}

/* Camera Styles */
.camera-wrapper {
    position: relative;
    display: none;
    margin-top: 10px;
}
#camera {
    width: 100%;
    border-radius: 8px;
    border: 2px solid #a80000;
}
.cancel-btn, .switch-btn {
    position: absolute;
    top: 5px;
    width: 35px;
    height: 35px;
    border: none;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    color: white;
}
.cancel-btn {
    right: 5px;
    background-color: #ff4d4d;
}
.cancel-btn:hover { background-color: #a80000; }
.switch-btn {
    left: 5px;
    background-color: #4d79ff;
}
.switch-btn:hover { background-color: #0033cc; }

/* ‚ùÑÔ∏è SNOWFALL EFFECT */
.snow {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background-image:
    radial-gradient(4px 4px at 20px 30px, rgb(252, 59, 59), transparent),
    radial-gradient(3px 3px at 40px 70px, rgb(255, 80, 80), transparent),
    radial-gradient(2px 2px at 90px 40px, rgb(255, 87, 87), transparent),
    radial-gradient(3px 3px at 130px 80px, rgb(255, 78, 78), transparent),
    radial-gradient(2px 2px at 160px 120px, rgb(255, 89, 89), transparent);
  background-size: 200px 200px;
  animation: snowfall 5s linear infinite;
  opacity: 1;
  z-index: 9999;
}

/* Snow movement */
@keyframes snowfall {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 0 600px;
  }
}

/* üéÑ FALLING MERRY CHRISTMAS */
.christmas-fall {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 9999;
}

.christmas-fall span {
  position: absolute;
  top: -50px;
  color: #ffd700;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  animation: fall linear infinite;
  text-shadow: 0 4px 8px rgba(0,0,0,0.4);
}

/* Different positions & speeds */
.christmas-fall span:nth-child(1) {
  left: 10%;
  animation-duration: 10s;
}

.christmas-fall span:nth-child(2) {
  left: 30%;
  animation-duration: 14s;
}

.christmas-fall span:nth-child(3) {
  left: 50%;
  animation-duration: 12s;
}

.christmas-fall span:nth-child(4) {
  left: 70%;
  animation-duration: 16s;
}

.christmas-fall span:nth-child(5) {
  left: 90%;
  animation-duration: 11s;
}

/* Falling animation */
@keyframes fall {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  100% {
    transform: translateY(110vh) rotate(15deg);
    opacity: 0;
  }
}

</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDsadz8GfNMOGaoHbzi7vB2LyvGb-ESxqs",
  authDomain: "musicdatabase-c57f8.firebaseapp.com",
  databaseURL: "https://musicdatabase-c57f8-default-rtdb.firebaseio.com",
  projectId: "musicdatabase-c57f8",
  storageBucket: "musicdatabase-c57f8.firebasestorage.app",
  messagingSenderId: "1081533752772",
  appId: "1:1081533752772:web:4e43c649e7e0bd7435f091",
  measurementId: "G-G9J9P224ZH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let chatRef = null;

// Listen messages for a tracking code
function startChat(trackCode) {
    const chatBox = document.getElementById('chat-box');
    chatBox.innerHTML = '<div style="text-align:center; font-style:italic;">Sending messages...</div>';

    if(chatRef) chatRef.off();
    chatRef = db.ref('chats/' + trackCode);

    // Fetch old messages first
    chatRef.once('value', snapshot => {
        chatBox.innerHTML = ''; // clear loading
        if(snapshot.exists()) {
            snapshot.forEach(child => {
                const data = child.val();
                displayMessage(data.sender, data.text, data.timestamp, data.image || '');
            });
        } else {
            chatBox.innerHTML = '<div style="text-align:center; font-style:italic;">No messages yet.</div>';
        }
    });

    // Listen for new messages
    chatRef.on('child_added', snapshot => {
        const data = snapshot.val();
        displayMessage(data.sender, data.text, data.timestamp, data.image || '');
    });
}


// Display message
function displayMessage(sender, text, timestamp, image) {
    const chatBox = document.getElementById('chat-box');
    const div = document.createElement('div');
    div.classList.add('message');
    div.classList.add(sender === 'User' ? 'sender-message' : 'receiver-message');

    if(image) {
        div.innerHTML = `<img src="${image}" style="max-width:100%; border-radius:5px;"><span class="timestamp">${timestamp}</span>`;
    } else {
        div.innerHTML = `${text} <span class="timestamp">${timestamp}</span>`;
    }
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Send text message
function sendMessage() {
    const trackCode = document.getElementById('track-code').value.trim();
    if(!trackCode) return alert('Enter tracking code!');
    const msgInput = document.getElementById('message-input');
    const text = msgInput.value.trim();
    if(!text) return;
    const timestamp = new Date().toLocaleTimeString();
    db.ref('chats/' + trackCode).push({ sender: 'User', text, timestamp });
    msgInput.value = '';
    startChat(trackCode);
}

// Camera
let stream;
let useFrontCamera = true;

function openCamera() {
    const wrapper = document.getElementById('camera-wrapper');
    const video = document.getElementById('camera');
    wrapper.style.display = 'block';
    const constraints = { video: { facingMode: useFrontCamera ? "user" : "environment" } };
    navigator.mediaDevices.getUserMedia(constraints)
        .then(s => { stream = s; video.srcObject = stream; })
        .catch(err => alert("Camera error: " + err));
}

function takeSnapshot() {
    const video = document.getElementById('camera');
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageData = canvas.toDataURL('image/png');
    const trackCode = document.getElementById('track-code').value.trim();
    if(!trackCode) return alert('Enter tracking code!');
    const timestamp = new Date().toLocaleTimeString();
    db.ref('chats/' + trackCode).push({ sender: 'User', image: imageData, timestamp });
    cancelCamera();
}

function cancelCamera() {
    const video = document.getElementById('camera');
    const wrapper = document.getElementById('camera-wrapper');
    if(stream) { stream.getTracks().forEach(track => track.stop()); stream = null; }
    wrapper.style.display = 'none';
}

function switchCamera() {
    useFrontCamera = !useFrontCamera;
    if(stream) cancelCamera();
    openCamera();
}

document.getElementById('load-chat-btn').addEventListener('click', () => {
    const trackCode = document.getElementById('track-code').value.trim();
    if(!trackCode) return alert('Enter tracking code!');
    startChat(trackCode);
});

// Optional: Enter key in tracking code input also loads chat
document.getElementById('track-code').addEventListener('keydown', e => {
    if(e.key === 'Enter') {
        const trackCode = e.target.value.trim();
        if(!trackCode) return alert('Enter tracking code!');
        startChat(trackCode);
    }
});

function sendImage() {
    const trackCode = document.getElementById('track-code').value.trim();
    if (!trackCode) return alert('Enter tracking code!');

    const input = document.getElementById('image-input');
    const file = input.files[0];
    if (!file) return alert('Select an image first!');

    const reader = new FileReader();
    reader.onload = function (e) {
        const timestamp = new Date().toLocaleTimeString();

        db.ref('chats/' + trackCode).push({
            sender: 'Admin',
            image: e.target.result,
            timestamp
        });

        input.value = ''; // reset input
    };
    reader.readAsDataURL(file);
}

</script>
</head>

<body>
    <div class="christmas-fall">
        <span>Merry Christmas üéÑ</span>
        <span>Merry Christmas üéÖ</span>
        <span>Merry Christmas ‚ùÑÔ∏è</span>
        <span>Merry Christmas üéÅ</span>
        <span>Merry Christmas ‚≠ê</span>
      </div>
      
    <div class="snow"></div>
<div class="chat-container">

    <div class="chat-header">
        <h1>Fast Express Delivery Service</h1>
        <p>Customer Care Chat</p>
    </div>

    <div class="track-input">
        <label>Tracking Code:</label>
        <input type="text" id="track-code" placeholder="FED-2025-001">
    </div>

    <div id="chat-box"></div>

    <div class="input-row">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
        <button id="load-chat-btn">Load Chat</button>
    </div>

    <div class="input-row">
        <button onclick="openCamera()">üì∏ Open Camera</button>
        <button onclick="takeSnapshot()">üì∑ Snap Picture</button>
        <input type="file" accept="image/*" id="image-input" style="display:none;" onchange="sendImage(event)">
<button onclick="document.getElementById('image-input').click()">üì∑ Send Picture</button>
    </div>

    <div class="camera-wrapper" id="camera-wrapper">
        <button class="cancel-btn" onclick="cancelCamera()">‚ùå</button>
        <button class="switch-btn" onclick="switchCamera()">üîÑ</button>
        <video id="camera" autoplay></video>
    </div>

</div>
</body>
</html>
